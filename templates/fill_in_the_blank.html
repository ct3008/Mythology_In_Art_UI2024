{% extends "quiz_layout.html" %}

{% block content %}
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <style>
        .container {
            margin-top: 80px;
        }

        .info_block {
            width: 70%;
            margin-top: -8px;
            margin-bottom: 20px;
            border: 2px solid black;
            display: none;
        }

        .fib-input {
            width: calc(100% + 10px); /* Adjust the width to match info_block and compensate for padding */
            /* Adjust other styles as needed */
        }

    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6 col6 container">
                <div class="image">
                    <img id="main_img" src= "{{ information.images[0] }}" alt="zeus" class="bleh">
                    <img id="hint_img" src= "{{ information.hints[0] }}" alt="zeus_hint" style="display: none;">
                </div>
            </div>
            <div class="col-md-6 col6 container">
                {% for fib in information.answers %}
                
                <label> {{ loop.index }}) Fill in the blank:
                    <input class="fib-input" list="browsers" name="fib_answer_{{ loop.index }}" />
                </label>
               
                <datalist id="browsers">
                    <option value="Artemis">Artemis</option>
					<option value="Apollo">Apollo</option>
					<option value="Athena">Athena</option>
					<option value="Dionysus">Dionysus</option>
					<option value="Hades">Hades</option>
					<option value="Hephaestus">Hephaestus</option>
					<option value="Herakles">Herakles</option>
					<option value="Hermes">Hermes</option>
					<option value="Poseidon">Poseidon</option>
					<option value="Zeus">Zeus</option>
                </datalist>
                
                <div class="info_block" id="info_block_{{ loop.index }}">
                    {{ information.explanation_text[loop.index - 1] }}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        var information = {{ information | tojson | safe }};
        var next_button = document.querySelector('.next-button');
        var buttons = document.getElementById('buttons-id');
        var learn_more = document.getElementById('learn-more-id');
        // console.log(information.answered);
        var questionType = 'fitb';
        console.log(information);
    
        updateInputs();
    
        // Disable the next button initially
        
    
        function submitQuiz() {
            var formData = {
                user_answers: information.user_answers
            };
    
            fetch(`/update_information/${information.id}/${questionType}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (response.ok) {
                    console.log('Quiz submitted successfully');
                } else {
                    console.error('Failed to submit quiz');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    
        function checkSubmit() {
            if (information.answered == 0) {
                var fibInputs = document.querySelectorAll('.fib-input');
                fibInputs.forEach(function(input, index) {
                    var inputValue = input.value.trim();
                    if (inputValue !== '') {
                        document.getElementById('info_block_' + (index + 1)).style.display = 'block';
                    }
                    if (inputValue.toLowerCase() == information.answers[index].toLowerCase()) {
                        document.getElementById('info_block_' + (index + 1)).style.borderColor = 'green';
                    } else {
                        document.getElementById('info_block_' + (index + 1)).style.borderColor = 'red';
                    }
                    information.user_answers[index] = inputValue;
                });
                information.answered = 1;
                // console.log(information);
                
                submitted = true;
    
                // Call submitQuiz function after updating user answers
                submitQuiz();
                // replaceButtons();
                next_button.style.display = 'block';
                
            }
        }
    
        function updateInputs() {
            if(information.answered == 1){
                var fibInputs = document.querySelectorAll('.fib-input');
                fibInputs.forEach(function(input, index) {
                    input.disabled = true;
                    input.value = information.user_answers[index];
                    var inputValue = input.value;
                    if (inputValue !== '') {
                        document.getElementById('info_block_' + (index + 1)).style.display = 'block';
                    }
                    if (inputValue.toLowerCase() == information.answers[index].toLowerCase()) {
                        document.getElementById('info_block_' + (index + 1)).style.borderColor = 'green';
                    } else {
                        document.getElementById('info_block_' + (index + 1)).style.borderColor = 'red';
                    }
                });
                next_button.style.display = 'block';
                // buttons.style.display = 'none';
                // reset_button.style.display = 'none';
                // submit_button.style.display = 'none';
                // learn_more.style.display = 'block';

            }else{
                next_button.style.display = 'none';
            }
            
        }
    
        function reset() {
            if (!information.answered) {
                var infoBlocks = document.querySelectorAll('.info_block');
                var fibInputs = document.querySelectorAll('.fib-input');
                infoBlocks.forEach(function(block) {
                    block.style.display = 'none';
                });
                fibInputs.forEach(function(input, index) {
                    input.value = '';
                });
            }
        }
    </script>
    
</body>

{% endblock %}
